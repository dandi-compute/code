{
   "describedBy": "https://raw.githubusercontent.com/AllenNeuralDynamics/aind-data-schema/main/src/aind_data_schema/core/processing.py",
   "schema_version": "1.1.4",
   "processing_pipeline": {
      "data_processes": [
         {
            "name": "Spike sorting",
            "software_version": "1.0",
            "start_date_time": "2025-11-25T19:35:16.210449-05:00",
            "end_date_time": "2025-11-25T19:37:00.210449-05:00",
            "input_location": "../data",
            "output_location": "../results",
            "code_url": "https://github.com/AllenNeuralDynamics/aind-ephys-spikesort-kilosort4",
            "code_version": null,
            "parameters": {
               "sorter_name": "kilosort4",
               "sorter_params": {
                  "fs": 30000,
                  "batch_size": 60000,
                  "nblocks": 5,
                  "Th_universal": 9,
                  "Th_learned": 8,
                  "nt": 61,
                  "shift": null,
                  "scale": null,
                  "artifact_threshold": null,
                  "nskip": 25,
                  "whitening_range": 32,
                  "highpass_cutoff": 300,
                  "binning_depth": 5,
                  "sig_interp": 20,
                  "drift_smoothing": [
                     0.5,
                     0.5,
                     0.5
                  ],
                  "nt0min": null,
                  "dmin": null,
                  "dminx": 32,
                  "min_template_size": 10,
                  "template_sizes": 5,
                  "nearest_chans": 10,
                  "nearest_templates": 100,
                  "max_channel_distance": null,
                  "templates_from_data": true,
                  "n_templates": 6,
                  "n_pcs": 6,
                  "Th_single_ch": 6,
                  "acg_threshold": 0.2,
                  "ccg_threshold": 0.25,
                  "cluster_downsampling": 20,
                  "x_centers": null,
                  "duplicate_spike_ms": 0.25,
                  "do_CAR": true,
                  "invert_sign": false,
                  "save_extra_vars": false,
                  "save_preprocessed_copy": false,
                  "torch_device": "auto",
                  "bad_channels": null,
                  "clear_cache": false,
                  "do_correction": false,
                  "skip_kilosort_preprocessing": false,
                  "keep_good_only": false,
                  "use_binary_file": null,
                  "delete_recording_dat": true,
                  "pool_engine": "process",
                  "n_jobs": -1,
                  "chunk_duration": "1s",
                  "progress_bar": false,
                  "mp_context": null,
                  "max_threads_per_worker": 1
               }
            },
            "outputs": {
               "empty_units": 0
            },
            "notes": "\n- KS4 found 18 units, 18 after removing empty templates.\n",
            "resources": null
         },
         {
            "name": "Ephys curation",
            "software_version": "2.0",
            "start_date_time": "2025-11-25T19:38:46.922424-05:00",
            "end_date_time": "2025-11-25T19:39:00.922424-05:00",
            "input_location": "../data",
            "output_location": "../results",
            "code_url": "https://github.com/AllenNeuralDynamics/aind-ephys-curation",
            "code_version": null,
            "parameters": {
               "query": "isi_violations_ratio < 0.5 and presence_ratio > 0.8 and amplitude_cutoff < 0.1",
               "noise_neural_classifier": "SpikeInterface/UnitRefine_noise_neural_classifier",
               "sua_mua_classifier": "SpikeInterface/UnitRefine_sua_mua_classifier",
               "recording_name": "block0_acquisition-ElectricalSeriesRaw_recording1"
            },
            "outputs": {
               "total_units": 18,
               "passing_qc": 18,
               "failing_qc": 0
            },
            "notes": "Curation query: isi_violations_ratio < 0.5 and presence_ratio > 0.8 and amplitude_cutoff < 0.1\nPassing default QC: 18/18Noise: 0 / 18\nSUA: 18 / 18\nMUA: 0 / 18\n",
            "resources": null
         },
         {
            "name": "Ephys preprocessing",
            "software_version": "1.0",
            "start_date_time": "2025-11-25T19:27:36.933336-05:00",
            "end_date_time": "2025-11-25T19:33:49.933336-05:00",
            "input_location": "../data",
            "output_location": "../results",
            "code_url": "https://github.com/AllenNeuralDynamics/aind-ephys-preprocessing",
            "code_version": null,
            "parameters": {
               "job_kwargs": {
                  "chunk_duration": "1s",
                  "progress_bar": false,
                  "mp_context": "spawn",
                  "n_jobs": -1
               },
               "denoising_strategy": "cmr",
               "min_preprocessing_duration": 120,
               "highpass_filter": {
                  "freq_min": 300.0,
                  "margin_ms": 5.0
               },
               "bandpass_filter": {
                  "freq_min": 300.0,
                  "freq_max": 6000.0,
                  "margin_ms": 5.0
               },
               "phase_shift": {
                  "margin_ms": 100.0
               },
               "detect_bad_channels": {
                  "method": "coherence+psd",
                  "dead_channel_threshold": -0.5,
                  "noisy_channel_threshold": 1.0,
                  "outside_channel_threshold": -0.3,
                  "outside_channels_location": "top",
                  "n_neighbors": 11,
                  "seed": 0
               },
               "remove_out_channels": true,
               "remove_bad_channels": true,
               "max_bad_channel_fraction": 0.5,
               "common_reference": {
                  "reference": "global",
                  "operator": "median"
               },
               "highpass_spatial_filter": {
                  "n_channel_pad": 60,
                  "n_channel_taper": null,
                  "direction": "y",
                  "apply_agc": true,
                  "agc_window_length_s": 0.01,
                  "highpass_butter_order": 3,
                  "highpass_butter_wn": 0.01
               },
               "motion_correction": {
                  "preset": "dredge_fast",
                  "detect_kwargs": {},
                  "select_kwargs": {},
                  "localize_peaks_kwargs": {},
                  "estimate_motion_kwargs": {
                     "bin_s": 1.0,
                     "win_step_um": 30.0,
                     "win_scale_um": 30.0
                  },
                  "interpolate_motion_kwargs": {},
                  "compute": true,
                  "apply": false
               },
               "filter_type": "highpass",
               "recording_name": "block0_acquisition-ElectricalSeriesRaw_recording1"
            },
            "outputs": {
               "channel_labels": [
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good",
                  "good"
               ]
            },
            "notes": "\n- Removed 0 outside of the brain.\n- Removed 0 bad channels after preprocessing.\n",
            "resources": null
         },
         {
            "name": "Ephys visualization",
            "software_version": "1.0",
            "start_date_time": "2025-11-25T19:39:58.172142-05:00",
            "end_date_time": "2025-11-25T19:40:05.172142-05:00",
            "input_location": "../data",
            "output_location": "../results",
            "code_url": "https://github.com/AllenNeuralDynamics/aind-ephys-visualization",
            "code_version": null,
            "parameters": {
               "timeseries": {
                  "n_snippets_per_segment": 2,
                  "snippet_duration_s": 0.5
               },
               "drift": {
                  "detection": {
                     "peak_sign": "neg",
                     "detect_threshold": 5,
                     "exclude_sweep_ms": 0.1
                  },
                  "localization": {
                     "ms_before": 0.1,
                     "ms_after": 0.3,
                     "radius_um": 100.0
                  },
                  "n_skip": 30,
                  "alpha": 0.15,
                  "vmin": -200,
                  "vmax": 0,
                  "cmap": "Greys_r",
                  "figsize": [
                     10,
                     10
                  ]
               },
               "motion": {
                  "cmap": "Greys_r",
                  "scatter_decimate": 15,
                  "figsize": [
                     15,
                     10
                  ]
               },
               "recording_name": "block0_acquisition-ElectricalSeriesRaw_recording1"
            },
            "outputs": {},
            "notes": "{}",
            "resources": null
         },
         {
            "name": "Ephys postprocessing",
            "software_version": "1.0",
            "start_date_time": "2025-11-25T19:37:45.716502-05:00",
            "end_date_time": "2025-11-25T19:38:21.716502-05:00",
            "input_location": "../data",
            "output_location": "../results",
            "code_url": "https://github.com/AllenNeuralDynamics/aind-ephys-postprocessing",
            "code_version": null,
            "parameters": {
               "duplicate_threshold": 0.9,
               "return_scaled": true,
               "random_spikes": {
                  "max_spikes_per_unit": 500,
                  "method": "uniform",
                  "margin_size": null,
                  "seed": null
               },
               "noise_levels": {
                  "num_chunks_per_segment": 20,
                  "chunk_size": 10000,
                  "seed": null
               },
               "waveforms": {
                  "ms_before": 3.0,
                  "ms_after": 4.0,
                  "dtype": null
               },
               "templates": {},
               "spike_amplitudes": {
                  "peak_sign": "neg"
               },
               "template_similarity": {
                  "method": "l1"
               },
               "correlograms": {
                  "window_ms": 50.0,
                  "bin_ms": 1.0
               },
               "isi_histograms": {
                  "window_ms": 100.0,
                  "bin_ms": 5.0
               },
               "unit_locations": {
                  "method": "monopolar_triangulation"
               },
               "spike_locations": {
                  "method": "grid_convolution"
               },
               "template_metrics": {
                  "upsampling_factor": 10,
                  "sparsity": null,
                  "include_multi_channel_metrics": true
               },
               "principal_components": {
                  "n_components": 5,
                  "mode": "by_channel_local",
                  "whiten": true
               },
               "recording_name": "block0_acquisition-ElectricalSeriesRaw_recording1"
            },
            "outputs": {
               "duplicated_units": 0
            },
            "notes": "\n- Removed 0 duplicated units.\n",
            "resources": null
         }
      ],
      "processor_full_name": "Alessio Buccino",
      "pipeline_version": null,
      "pipeline_url": null,
      "note": null
   },
   "analyses": [],
   "notes": null
}